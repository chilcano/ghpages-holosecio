<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Minimum Viable Security for a Kubernetised Webapp: HTTP Basic Auth on TLS - Part2 | Holistic Security</title>
  <meta name="description" content="With The Systems Thinking Methodology we are able to see any problem in a complete and holistic manner, in fact, The Systems Thinking Methodology allows us to solve complex problems (IT Security, Global Warming, World Poverty, etc.) by considering new factors, elements and variables (usability, trust, quality, risk, etc.) which were not considered initially.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="Minimum Viable Security for a Kubernetised Webapp: HTTP Basic Auth on TLS - Part2" />
<meta property="og:description" content="In the Minimum Viable Security for a Kubernetised Webapp: TLS everywhere - Part1 I used the Affordable K8s&#39; Terraform scripts to create a K8s Cluster with the Jetstack Cert-Manager and the NGINX Ingress Controller pre-installed, now I want to improve the security of a Webapp hosted in that Cluster according the Minimum Viable Security (MVSec) and Pareto Principle or 80/20 rule.

In this post I&rsquo;ll explain how to enable and configure HTTP Basic Authentication over TLS in the Weave Scope webapp running in the recently created K8s Cluster." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://holisticsecurity.io/2020/03/19/minimum-viable-security-for-a-k8s-webapp-http-basic-auth-on-tls-part2/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2020-03-19T00:10:00&#43;00:00" />
<meta property="article:modified_time" content="2020-03-19T00:10:00&#43;00:00" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Minimum Viable Security for a Kubernetised Webapp: HTTP Basic Auth on TLS - Part2"/>
<meta name="twitter:description" content="In the Minimum Viable Security for a Kubernetised Webapp: TLS everywhere - Part1 I used the Affordable K8s&#39; Terraform scripts to create a K8s Cluster with the Jetstack Cert-Manager and the NGINX Ingress Controller pre-installed, now I want to improve the security of a Webapp hosted in that Cluster according the Minimum Viable Security (MVSec) and Pareto Principle or 80/20 rule.

In this post I&rsquo;ll explain how to enable and configure HTTP Basic Authentication over TLS in the Weave Scope webapp running in the recently created K8s Cluster."/>

  
  
    
  
  
  <link rel="stylesheet" href="https://holisticsecurity.io/css/style-white.css">
  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://holisticsecurity.io/images/favicon.ico" />

  
  
  
  
  
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-156433649-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

    <header id="header">
  <a href="https://holisticsecurity.io/">
  
    <div id="logo" style="background-image: url(https://holisticsecurity.io/images/logo.png)"></div>
  
  <div id="title">
    <h1>Holistic Security</h1>
  </div>
  </a>
  <div id="nav">
    <ul>
      <li class="icon">
        <a href="#"><i class="fas fa-bars fa-2x"></i></a>
      </li>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/post">Writings</a></li>
      
        <li><a href="/categories">Categories</a></li>
      
        <li><a href="/tags">Tags</a></li>
      
        <li><a href="/about">About</a></li>
      
    </ul>
  </div>
</header>



    
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  
  <h1 class="posttitle" itemprop="name headline"> Minimum Viable Security for a Kubernetised Webapp: HTTP Basic Auth on TLS - Part2 </h1>
  
  <div class="content" itemprop="articleBody">
  
    <p>In the <a href="/2020/03/08/minimum-viable-security-for-a-k8s-webapp-tls-everywhere-part1">Minimum Viable Security for a Kubernetised Webapp: TLS everywhere - Part1</a> I used the <a href="https://github.com/chilcano/affordable-k8s">Affordable K8s</a>' Terraform scripts to create a K8s Cluster with the Jetstack Cert-Manager and the NGINX Ingress Controller pre-installed, now I want to improve the security of a Webapp hosted in that Cluster according the Minimum Viable Security (MVSec) and Pareto Principle or 80/20 rule.</p>
<p><a href="/assets/blog20200319/mvp-sec-part2-http-basic-auth-over-tls-for-weave-scope-with-nginx-ingress-jetstack-cert-manager-lets-encrypt.png"><img src="/assets/blog20200319/mvp-sec-part2-http-basic-auth-over-tls-for-weave-scope-with-nginx-ingress-jetstack-cert-manager-lets-encrypt.png" alt=""></a></p>
<p>In this post I&rsquo;ll explain how to enable and configure <a href="https://en.wikipedia.org/wiki/Basic_access_authentication">HTTP Basic Authentication</a> over TLS in the <a href="https://www.weave.works/oss/scope">Weave Scope</a> webapp running in the recently created K8s Cluster.</p>
<h2 id="getting-started">Getting started</h2>
<p>I recommend follow the <a href="/2020/03/08/minimum-viable-security-for-a-k8s-webapp-tls-everywhere-part1">Part 1</a> to get this scenario.
Let&rsquo;s explore the K8s services created.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ kubectl get svc -n weave
</code></pre></div><ul>
<li>The <code>weave-scope-app-svc-np</code> NodePort service will create the <code>weave-scope.cloud.holisticsecurity.io</code> subdomain entry in AWS Route 53.</li>
<li>The <code>weave-scope-app-svc-np</code> NodePort service is required when I&rsquo;m getting access through SSH tunnel.</li>
<li>The <code>weave-scope-app</code> ClusterIP service was created when Weave Scope was installed.</li>
</ul>
<p>Get access through SSH to your K8s Cluster and clone the <a href="https://github.com/chilcano/affordable-k8s">Affordable K8s</a> Git Repo. It contains all YAML files required for next steps.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ ssh ubuntu@<span style="color:#66d9ef">$(</span>terraform output master_dns<span style="color:#66d9ef">)</span> -i ~/Downloads/ssh-key-for-us-east-1.pem

$ git clone https://github.com/chilcano/affordable-k8s
$ cd affordable-k8s/examples/
</code></pre></div><p>Since I&rsquo;ll use HTTP Basic Auth, I need creating a K8s secret resources that the NGINX Ingress resources for Weave Scope will need.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ sudo apt install apache2-utils -y
$ htpasswd -bc auth YOUR_USR YOUR_PWD
$ kubectl create secret generic secret-http-basic-auth --from-file<span style="color:#f92672">=</span>auth -n weave
</code></pre></div><h3 id="enabling-and-configuring-http-basic-authentication-over-tls">Enabling and configuring HTTP Basic Authentication over TLS</h3>
<h4 id="1-create-a-lets-encrypt-issuer">1. Create a Letâ€™s Encrypt Issuer</h4>
<p>A Certificate issuer is the definition for where <a href="https://cert-manager.io/docs/concepts/issuer/#namespaces">Jetstack Cert-Manager</a> will get request TLS certs. An <code>Issuer</code> is specific to a single namespace in Kubernetes, and a <code>ClusterIssuer</code> is meant to be a cluster-wide definition for the same purpose.</p>
<p>In a scenario or project real, we should generate certificates for testing (<code>staging</code>) purporses, once tested the process to get and configure testing certificates, the next step is to get and use final (<code>production</code>) certificates. That is the reason I provide <code>letsencrypt-issuer-staging.yaml</code> and <code>letsencrypt-issuer-prod.yaml</code>. Then, let&rsquo;s create both issuers.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ kubectl apply -f letsencrypt-issuer-staging.yaml -n weave
$ kubectl apply -f letsencrypt-issuer-prod.yaml -n weave
</code></pre></div><p>Checking the Let&rsquo;s Encrypt Issuers. If you got <code>Reason: ACMEAccountRegistered</code>, the Issuer is ready to issue certificates.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ kubectl get issuer,secret -n weave
NAME                                                READY   AGE
issuer.cert-manager.io/letsencrypt-issuer-prod      True    14s
issuer.cert-manager.io/letsencrypt-issuer-staging   True    76s

NAME                                        TYPE                                  DATA   AGE
secret/default-token-gzbzs                  kubernetes.io/service-account-token   <span style="color:#ae81ff">3</span>      7m30s
secret/letsencrypt-issuer-privkey-prod      Opaque                                <span style="color:#ae81ff">1</span>      12s
secret/letsencrypt-issuer-privkey-staging   Opaque                                <span style="color:#ae81ff">1</span>      74s
secret/secret-http-basic-auth               Opaque                                <span style="color:#ae81ff">1</span>      3m6s
secret/weave-scope-token-vb7vg              kubernetes.io/service-account-token   <span style="color:#ae81ff">3</span>      7m31s


$ kubectl describe issuer letsencrypt-issuer-staging -n weave
$ kubectl describe issuer letsencrypt-issuer-prod -n weave
</code></pre></div><p>If you have under <code>Status</code> this <code>Reason: ACMEAccountRegistered</code> message in both issuers, that means they are ready to get certificates from Let&rsquo;s Encrypt.</p>
<h4 id="2-create-the-ingress-resource-with-a-staging-certificate">2. Create the Ingress resource with a Staging Certificate</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ kubectl apply -f weave-scope-app-ingress.yaml 
</code></pre></div><p>With <code>weave-scope-app-ingress.yaml</code> I&rsquo;ll have a testing certificate.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">extensions/v1beta1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Ingress</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">weave-scope-app-ingress</span>
  <span style="color:#f92672">annotations</span>:
    <span style="color:#f92672">kubernetes.io/ingress.class</span>: <span style="color:#e6db74">&#34;nginx&#34;</span>
    <span style="color:#f92672">cert-manager.io/issuer</span>: <span style="color:#e6db74">&#34;letsencrypt-issuer-staging&#34;</span>
    <span style="color:#75715e">#cert-manager.io/issuer: &#34;letsencrypt-issuer-prod&#34;</span>
    <span style="color:#f92672">nginx.ingress.kubernetes.io/auth-type</span>: <span style="color:#ae81ff">basic</span>
    <span style="color:#f92672">nginx.ingress.kubernetes.io/auth-secret</span>: <span style="color:#ae81ff">secret-http-basic-auth</span>
  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">weave</span>
<span style="color:#f92672">spec</span>:
  <span style="color:#f92672">rules</span>:
  - <span style="color:#f92672">host</span>: <span style="color:#ae81ff">weave-scope.cloud.holisticsecurity.io</span>
    <span style="color:#f92672">http</span>:
      <span style="color:#f92672">paths</span>:
      - <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/</span>
        <span style="color:#f92672">backend</span>:
          <span style="color:#f92672">serviceName</span>: <span style="color:#ae81ff">weave-scope-app-svc-np </span> <span style="color:#75715e">## NodePort</span>
          <span style="color:#f92672">servicePort</span>: <span style="color:#ae81ff">82</span>
  <span style="color:#f92672">tls</span>:
  - <span style="color:#f92672">hosts</span>:
    - <span style="color:#ae81ff">weave-scope.cloud.holisticsecurity.io</span>
    <span style="color:#f92672">secretName</span>: <span style="color:#ae81ff">cert-tls</span>
</code></pre></div><p>When creating the TLS NGINX Ingress resources, the NGINX Ingress Controller underhood will execute the next steps:</p>
<ul>
<li>Request a TLS Cert through the Let&rsquo;s Encrypt Issuer (<code>letsencrypt-issuer-staging</code>).</li>
<li>Load the issued TLS Cert and its configuration to route the <code>weave-scope.cloud.holisticsecurity.io</code> incomming traffic over TLS to Weave Scope pods.</li>
<li>The HTTP Basic Auth annotations (<code>nginx.ingress.kubernetes.io/auth-type: basic</code> and <code>nginx.ingress.kubernetes.io/auth-secret: secret-http-basic-auth</code>) will be used.</li>
</ul>
<p>If everything looks good, you might check the K8s <code>secret</code> resource and the Let&rsquo;s Encrypt Issuer resources (<code>certificate</code>, <code>certificaterequest</code>, <code>order</code> and <code>challenge</code>) details.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ kubectl get ingress,secret,certificate,certificaterequest,order -n weave 
$ kubectl describe secret cert-tls -n weave
Name:         cert-tls
Namespace:    weave
Labels:       &lt;none&gt;
Annotations:  cert-manager.io/alt-names: weave-scope.cloud.holisticsecurity.io
              cert-manager.io/certificate-name: cert-tls
              cert-manager.io/common-name: weave-scope.cloud.holisticsecurity.io
              cert-manager.io/ip-sans: 
              cert-manager.io/issuer-kind: Issuer
              cert-manager.io/issuer-name: letsencrypt-issuer-staging
              cert-manager.io/uri-sans: 

Type:  kubernetes.io/tls

Data
<span style="color:#f92672">====</span>
tls.crt:  <span style="color:#ae81ff">3610</span> bytes
tls.key:  <span style="color:#ae81ff">1675</span> bytes
ca.crt:   <span style="color:#ae81ff">0</span> bytes


$ kubectl describe certificate cert-tls -n weave
...
...
Events:
  Type    Reason        Age    From          Message
  ----    ------        ----   ----          -------
  Normal  GeneratedKey  3m39s  cert-manager  Generated a new private key
  Normal  Requested     3m36s  cert-manager  Created new CertificateRequest resource <span style="color:#e6db74">&#34;cert-tls-3240899713&#34;</span>
  Normal  Issued        2m2s   cert-manager  Certificate issued successfully
</code></pre></div><p>Now, if you open this url <code>https://weave-scope.cloud.holisticsecurity.io</code> in your browser you will get an error about <em>Certificate desn&rsquo;t Trusted</em> and can not get access to Weave Scope. That doesn&rsquo;t mean that Cert-Manager or Ingress Controller don&rsquo;t work, that means specifically this:</p>
<blockquote>
<p>weave-scope.cloud.holisticsecurity.io has a security policy called HTTP Strict Transport Security (HSTS), which <br>
means that Firefox can only connect to it securely. You can&rsquo;t add an exceptions to visit this site.</p>
<p>The issue is most likely with the website, and there is nothing you can do.</p>
</blockquote>
<p><a href="/assets/blog20200319/mvp-sec-part2-weave-1-tls-http-basic-auth-fake-cert-error.png"><img src="/assets/blog20200319/mvp-sec-part2-weave-1-tls-http-basic-auth-fake-cert-error.png" alt=""></a></p>
<p><a href="/assets/blog20200319/mvp-sec-part2-weave-2-tls-http-basic-auth-fake-cert-error.png"><img src="/assets/blog20200319/mvp-sec-part2-weave-2-tls-http-basic-auth-fake-cert-error.png" alt=""></a></p>
<h4 id="3-create-the-ingress-resource-and-getting-a-production-certificate">3. Create the Ingress resource and getting a Production Certificate</h4>
<p>In this point we are ready to get a certificate for production purposes, before we should remove the previous ingress resource and its corresponding generated secret.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ kubectl delete ingress weave-scope-app-ingress -n weave
$ kubectl delete secret cert-tls -n weave
</code></pre></div><p>Edit the <code>weave-scope-app-ingress.yaml</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ nano weave-scope-app-ingress.yaml 
</code></pre></div><p>Uncomment this line <code>cert-manager.io/issuer: &quot;letsencrypt-issuer-prod&quot;</code> and comment this other <code>cert-manager.io/issuer: &quot;letsencrypt-issuer-staging&quot;</code> in <code>weave-scope-app-ingress.yaml</code> file.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">extensions/v1beta1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Ingress</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">weave-scope-app-ingress</span>
  <span style="color:#f92672">annotations</span>:
    <span style="color:#f92672">kubernetes.io/ingress.class</span>: <span style="color:#e6db74">&#34;nginx&#34;</span>
    <span style="color:#75715e">#cert-manager.io/issuer: &#34;letsencrypt-issuer-staging&#34;</span>
    <span style="color:#f92672">cert-manager.io/issuer</span>: <span style="color:#e6db74">&#34;letsencrypt-issuer-prod&#34;</span>
    <span style="color:#f92672">nginx.ingress.kubernetes.io/auth-type</span>: <span style="color:#ae81ff">basic</span>
    <span style="color:#f92672">nginx.ingress.kubernetes.io/auth-secret</span>: <span style="color:#ae81ff">secret-http-basic-auth</span>
  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">weave</span>
<span style="color:#f92672">spec</span>:
  <span style="color:#f92672">rules</span>:
  - <span style="color:#f92672">host</span>: <span style="color:#ae81ff">weave-scope.cloud.holisticsecurity.io</span>
    <span style="color:#f92672">http</span>:
      <span style="color:#f92672">paths</span>:
      - <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/</span>
        <span style="color:#f92672">backend</span>:
          <span style="color:#f92672">serviceName</span>: <span style="color:#ae81ff">weave-scope-app-svc-np </span> <span style="color:#75715e">## NodePort</span>
          <span style="color:#f92672">servicePort</span>: <span style="color:#ae81ff">82</span>
  <span style="color:#f92672">tls</span>:
  - <span style="color:#f92672">hosts</span>:
    - <span style="color:#ae81ff">weave-scope.cloud.holisticsecurity.io</span>
    <span style="color:#f92672">secretName</span>: <span style="color:#ae81ff">cert-tls</span>
</code></pre></div><p>Now create the updated ingress.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ kubectl apply -f weave-scope-app-ingress.yaml 
</code></pre></div><p>Check all resources created.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ kubectl get ingress,secret,certificate,certificaterequest,order -n weave 
NAME                                         HOSTS                                   ADDRESS   PORTS     AGE
ingress.extensions/weave-scope-app-ingress   weave-scope.cloud.holisticsecurity.io             80, <span style="color:#ae81ff">443</span>   68s

NAME                                        TYPE                                  DATA   AGE
secret/cert-tls                             kubernetes.io/tls                     <span style="color:#ae81ff">3</span>      66s
secret/default-token-gzbzs                  kubernetes.io/service-account-token   <span style="color:#ae81ff">3</span>      31m
secret/letsencrypt-issuer-privkey-prod      Opaque                                <span style="color:#ae81ff">1</span>      24m
secret/letsencrypt-issuer-privkey-staging   Opaque                                <span style="color:#ae81ff">1</span>      25m
secret/secret-http-basic-auth               Opaque                                <span style="color:#ae81ff">1</span>      27m
secret/weave-scope-token-vb7vg              kubernetes.io/service-account-token   <span style="color:#ae81ff">3</span>      31m

NAME                                   READY   SECRET     AGE
certificate.cert-manager.io/cert-tls   True    cert-tls   68s

NAME                                                     READY   AGE
certificaterequest.cert-manager.io/cert-tls-1393507612   True    66s

NAME                                                        STATE   AGE
order.acme.cert-manager.io/cert-tls-1393507612-2800536094   valid   66s
</code></pre></div><p>Now, if you open this url <code>https://weave-scope.cloud.holisticsecurity.io</code> in your browser you will be prompted for user and password to get access to Weave Scope.</p>
<p><a href="/assets/blog20200319/mvp-sec-part2-weave-3-tls-http-basic-auth-ok.png"><img src="/assets/blog20200319/mvp-sec-part2-weave-3-tls-http-basic-auth-ok.png" alt=""></a></p>
<p><a href="/assets/blog20200319/mvp-sec-part2-weave-4-tls-http-basic-auth-info.png"><img src="/assets/blog20200319/mvp-sec-part2-weave-4-tls-http-basic-auth-info.png" alt=""></a></p>
<p>Once authenticated, you will be able to check the TLS Certificate issued by Let&rsquo;s Encrypt.
<a href="/assets/blog20200319/mvp-sec-part2-weave-5-tls-http-basic-auth-certificates.png"><img src="/assets/blog20200319/mvp-sec-part2-weave-5-tls-http-basic-auth-certificates.png" alt=""></a></p>
<p><a href="/assets/blog20200319/mvp-sec-part2-weave-6-tls-http-basic-authed.png"><img src="/assets/blog20200319/mvp-sec-part2-weave-6-tls-http-basic-authed.png" alt=""></a></p>
<h4 id="4-troubleshooting-with-logs">4. Troubleshooting with logs</h4>
<p>Check the Cert-Manager logs to see if the TLS Cert, Keys, CSR, etc. were requested and approved successfully.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ kubectl logs -f -n cert-manager -lapp<span style="color:#f92672">=</span>cert-manager
</code></pre></div><p>Check the NGINX Ingress Controller logs to see if the TLS Cert and configuration were created and loaded successfully.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ kubectl logs -f -n ingress-nginx -lapp.kubernetes.io/part-of<span style="color:#f92672">=</span>ingress-nginx
</code></pre></div><h2 id="conclusions">Conclusions</h2>
<h3 id="you-need-a-pki">You need a PKI</h3>
<p>Let&rsquo;s Encrypt technically can issue TLS Client Certificates, but it isn&rsquo;t recommended because using Letâ€™s Encryptâ€™s DV certificates directly as client certificates doesnâ€™t offer a lot of flexibility, and probably doesnâ€™t enhance overall security in most configurations. The best option would be to use your own CA for this process, as that allows for much more direct control, and client certificates donâ€™t have to be publicly trusted by all clients, just trusted by your server.<br>
For other side, at operationaly speaking, TLS Certificate Management (revocation, renewals, validation, etc.) is expensive, that means we will require a PKI with a powerful RESTful API to manage the Cert Lifecycle during the deployment of Containers-based Applications.<br>
A PKI will be helpful allowing to create a private CA or Intermediate CA and manage their Lifecycle easily.</p>
<blockquote>
<p>I use Jetstack Cert-Manager to manage certs issued for Let&rsquo;s Encrypt, Hashicorp Vault and Venafi, in the 2nd post I&rsquo;ll explain how to use Hashicorp Vault as CA for enablling TLS and Mutual TLS Authentication (MTLS) in the services running in Kubernetes Cluster.<br>
In the 3rd post I&rsquo;ll explain how to integrate and use Hashicorp Vault as a PKI.</p>
</blockquote>
<h3 id="you-need-an-iam-system">You need an IAM System</h3>
<p>Mutual TLS Authentication (MTLS) is better than HTTP Basic Authentication over TLS, instead of using a pre-shared key with HTTP Basic Authentication, with TLS you are able to use a TLS Client Certificate, in fact to enable MTLS will require to issue 2 certificates (TLS Server and TLS Client Certificates) and deploy TLS configuration to enable authentication for that specified Service or Web Application. That will work perfectly if you have to enable MTLS for few services or applications, but in a scenario where you have several APIs or a Container-based Distributed Application, the task of dealing MTLS will turn very complicated. For that, many Organizations consider adoption of an IAM System like WSO2 Identity Server, KeyCloak, DEX, etc. I recommend have a look for IAM at OSS Product List that I prepared in the post <a href="https://holisticsecurity.io/2020/02/10/security-along-the-container-based-sdlc#oss-doc-link">Security along Container-based SDLC - OSS Tools List</a>.</p>
<blockquote>
<p>In the 4th post I&rsquo;ll explain how to integrate an IAM opensource as OIDC Provider for Kubernetes.</p>
</blockquote>
<h2 id="references">References</h2>
<ul>
<li><a href="https://cert-manager.io/docs/tutorials/acme/ingress">Cert-Manager tutorial - Securing NGINX-ingress</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-an-nginx-ingress-with-cert-manager-on-digitalocean-kubernetes">How to Set Up an Nginx Ingress with Cert-Manager on DigitalOcean Kubernetes</a></li>
</ul>
  
  </div>
</article>


    <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2021  Holistic Security 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/post">Writings</a></li>
         
        <li><a href="/categories">Categories</a></li>
         
        <li><a href="/tags">Tags</a></li>
         
        <li><a href="/about">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-156433649-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
</html>
