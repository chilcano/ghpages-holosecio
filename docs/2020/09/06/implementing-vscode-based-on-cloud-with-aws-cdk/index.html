<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Implementing VSCode-based (Code-Server) on Cloud with AWS CDK | Holistic Security</title>
  <meta name="description" content="Hugo is a general-purpose website framework. Technically speaking, Hugo is a static site generator. Unlike systems that dynamically build a page with each visitor request, Hugo builds pages when you create or update your content. Since websites are viewed far more often than they are edited, Hugo is designed to provide an optimal viewing experience for your websiteâ€™s end users and an ideal writing experience for website authors.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="Implementing VSCode-based (Code-Server) on Cloud with AWS CDK" />
<meta property="og:description" content="As I stated in the previous post &ldquo;A Cloud IDE for the masses&rdquo;, in this post I will explain you how to deploy Code-Server on AWS. But to make it more interesting, I&rsquo;m going to use AWS Cloud Development Kit (AWS CDK), it is a framework to model and provision your cloud applications and resources using knew programming language (TypeScript, Python, Java, etc.), no more YAML or Json.
We are going to deploy Code-Server (a NodeJS web app) into an EC2 instance, using Ubuntu AMI and provisioning all package through a bash scripts (UserData), as in the below diagram depict it.
{:style=&ldquo;display:block;margin:auto;&quot;}" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://chilcano.github.io/ghpages-holosecio/2020/09/06/implementing-vscode-based-on-cloud-with-aws-cdk/" />
<meta property="article:published_time" content="2020-09-06T11:00:00+00:00" />
<meta property="article:modified_time" content="2020-09-06T11:00:00+00:00" />

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Implementing VSCode-based (Code-Server) on Cloud with AWS CDK"/>
<meta name="twitter:description" content="As I stated in the previous post &ldquo;A Cloud IDE for the masses&rdquo;, in this post I will explain you how to deploy Code-Server on AWS. But to make it more interesting, I&rsquo;m going to use AWS Cloud Development Kit (AWS CDK), it is a framework to model and provision your cloud applications and resources using knew programming language (TypeScript, Python, Java, etc.), no more YAML or Json.
We are going to deploy Code-Server (a NodeJS web app) into an EC2 instance, using Ubuntu AMI and provisioning all package through a bash scripts (UserData), as in the below diagram depict it.
{:style=&ldquo;display:block;margin:auto;&quot;}"/>

  
  
    
  
  
  <link rel="stylesheet" href="https://chilcano.github.io/ghpages-holosecio/css/style-white.css">
  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://chilcano.github.io/ghpages-holosecio/images/favicon.ico" />

  
  
  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

    <header id="header">
  <a href="https://chilcano.github.io/ghpages-holosecio/">
  
    <div id="logo" style="background-image: url(https://chilcano.github.io/ghpages-holosecio/images/logo.png)"></div>
  
  <div id="title">
    <h1>Holistic Security</h1>
  </div>
  </a>
  <div id="nav">
    <ul>
      <li class="icon">
        <a href="#"><i class="fas fa-bars fa-2x"></i></a>
      </li>
      
        <li><a href="/ghpages-holosecio/">Home</a></li>
      
        <li><a href="/ghpages-holosecio/posts">Writings</a></li>
      
        <li><a href="/ghpages-holosecio/tags">Tags</a></li>
      
        <li><a href="/ghpages-holosecio/about">About</a></li>
      
    </ul>
  </div>
</header>



    
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <div class="content" itemprop="articleBody">
  
    <p>As I stated in the previous post &ldquo;<a href="/2020/09/06/a-cloud-ide-for-the-masses">A Cloud IDE for the masses</a>&rdquo;, in this post I will explain you how to deploy <a href="https://github.com/cdr/code-server">Code-Server</a> on AWS. But to make it more interesting, I&rsquo;m going to use <a href="https://aws.amazon.com/cdk/">AWS Cloud Development Kit (AWS CDK)</a>, it is a framework to model and provision your cloud applications and resources using knew programming language (TypeScript, Python, Java, etc.), no more YAML or Json.</p>
<p>We are going to deploy <a href="https://github.com/cdr/code-server">Code-Server</a> (a NodeJS web app) into an EC2 instance, using Ubuntu AMI and provisioning all package through a bash scripts (UserData), as in the below diagram depict it.</p>
<p><img src="/assets/blog20200906_cloudidecdk/0-cloud-ide-aws-arch-cdk-ec2-ami-userdata-vscode-code-server.png" alt="">{:style=&ldquo;display:block;margin:auto;&quot;}</p>
<h3 id="persisting-the-code">Persisting the code</h3>
<p>Code-Server doesn&rsquo;t require a Database, the only thing to persist is the code. The EC2 instance has enough room to download and persist the code and its dependencies like you do it in your local computer. If you have completed your project, then you can push your code to your Git repository.</p>
<h3 id="on-demand-computing">On-demand computing</h3>
<p>If you want compile, run your code, or want to process long task, then you will need processing and computing capacity and you will get from EC2 instance you choose. If you need more just run again your IaC with different <code>EC2 Instance Type</code>. This example uses a <code>t2.micro</code>.</p>
<h3 id="security">Security</h3>
<p>Code-Server is a web application and will require a secure configuration like a standard web application. By default, the only security control that Code-Server is authentication. A fresh Code-Server installation will generate during its installation a password. And considering that, we need implementing extra security around the web application like TLS and/or Mutual TLS Authentication, Whitelisting IP and only open the HTTP/HTTPS port. If you have more time, you could implement a Reverse Proxy with security capabilities or using additional AWS services like AWS API Gateway, AWS CloudFront (WAF), etc.</p>
<h3 id="i-already-have-vscode-can-share-my-settings-theme-and-extensions">I already have VSCode, can share my settings, theme and extensions?</h3>
<p>Yes, you can do it.<br>
This is the part that I like the most, I&rsquo;m in love with <a href="https://marketplace.visualstudio.com/items?itemName=Shan.code-settings-sync">Settings Sync</a> Extension, only I do configure a Gist ID and Setting Sync automatically download previous VS Code' settings (theme, style, configuration, etc.) from Gist and install all VS Code extensions for you.</p>
<p>Well, let&rsquo;s get to the point.</p>
<h3 id="getting-started">Getting started</h3>
<h4 id="1-cdk-installation">1. CDK installation</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ sudo apt install -y nodejs npm
$ sudo npm i -g aws-cdk
</code></pre></div><h4 id="2-install-code-server-on-aws">2. Install Code-Server on AWS</h4>
<p>You don&rsquo;t have to code anything, I&rsquo;ve created the AWS CDK project in TypeScript for you, just clone the Git repo and run it.</p>
<p>Before anything configure your AWS account and region:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ export AWS_ACCESS_KEY_ID<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;abc&#34;</span>
$ export AWS_SECRET_ACCESS_KEY<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;pqr&#34;</span>
$ export AWS_DEFAULT_REGION<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;us-east-1&#34;</span>
</code></pre></div><p>Initialize the CDK project:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ git clone https://github.com/chilcano/aws-cdk-samples
$ cd aws-cdk-samples/code-server-ec2
$ nmp install
</code></pre></div><p>If you want to review the CloudFormation code that the CDK project generates, execute this command:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ cdk synth
</code></pre></div><p>And finally, deploy the CDK project:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ cdk deploy
</code></pre></div><p>You will get this output in your terminal. That means everything went well.
<a href="/assets/blog20200906_cloudidecdk/1-cdk-deploy-output.png"><img src="/assets/blog20200906_cloudidecdk/1-cdk-deploy-output.png" alt="">{:width=&ldquo;400&rdquo;}{:style=&ldquo;display:block;margin:auto;&quot;}</a></p>
<h4 id="3-calling-the-code-server">3. Calling the Code-Server</h4>
<p>From your AWS Web Console, get the <code>Public DNS (IPv4)</code> or <code>IPv4 Public IP</code> about the EC2 instance created, with that information connect to the host through SSH and get the Code-Server&rsquo;s password that generates by default:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ ssh ubuntu@ec2-54-227-165-113.compute-1.amazonaws.com -i ~/Downloads/chilcan0.pem 

ubuntu@ip-10-0-0-117:~$ cat .config/code-server/config.yaml 
bind-addr: 127.0.0.1:8080
auth: password
password: 5995b51c25c621190abd55e8
cert: false
</code></pre></div><p>Now, create the SSH tunnel:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ ssh -nNT -L 8123:localhost:8080 ubuntu@ec2-54-227-165-113.compute-1.amazonaws.com -i ~/Downloads/chilcan0.pem
</code></pre></div><p>Finally, open the URL <a href="http://localhost:8123">http://localhost:8123</a> in your browser, you should see this:</p>
<p><a href="/assets/blog20200906_cloudidecdk/2-app-2.png"><img src="/assets/blog20200906_cloudidecdk/2-app-2.png" alt="">{:width=&ldquo;360&rdquo;}</a> <a href="/assets/blog20200906_cloudidecdk/2-app-3.png"><img src="/assets/blog20200906_cloudidecdk/2-app-3.png" alt="">{:width=&ldquo;360&rdquo;}</a></p>
<h4 id="4-restoring-your-vscode-settings-in-code-server">4. Restoring your VSCode' settings in Code-Server</h4>
<p>I&rsquo;m using a bash scripts as <code>userData</code> to install Code-Server and only the <a href="https://marketplace.visualstudio.com/items?itemName=Shan.code-settings-sync">Settings-Sync</a> extension that will allow restore a previous Code-Server or VS Code settings, even other extensions. For that you need a Gist ID that your previous Code-Server or VS Code has generated. If you don&rsquo;t have one, you can use mine.</p>
<blockquote>
<p>Settings-Sync Gist ID: b5f88127bd2d89289dc2cd36032ce856<br>
Gist URL: <a href="https://gist.github.com/chilcano/b5f88127bd2d89289dc2cd36032ce856">https://gist.github.com/chilcano/b5f88127bd2d89289dc2cd36032ce856</a></p>
</blockquote>
<p>Once restored all Code-Server settings, you will see this:</p>
<p><a href="/assets/blog20200906_cloudidecdk/2-app-3b.png"><img src="/assets/blog20200906_cloudidecdk/2-app-3b.png" alt="">{:width=&ldquo;360&rdquo;}</a> <a href="/assets/blog20200906_cloudidecdk/2-app-3c.png"><img src="/assets/blog20200906_cloudidecdk/2-app-3c.png" alt="">{:width=&ldquo;360&rdquo;}</a></p>
<p>That&rsquo;s it.
Hope this helps.</p>
<h3 id="references">References</h3>
<ol>
<li><a href="https://holisticsecurity.io/2020/04/09/building-an-affordable-remote-devops-desktop-on-aws">Building an affordable remote DevOps desktop on AWS - Apr 9, 2020</a></li>
<li><a href="https://holisticsecurity.io/2020/08/05/a-cloud-ide-for-the-masses">A Cloud IDE for the masses - Aug 5, 2020</a></li>
</ol>
  
  </div>
</article>


    <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2021  You 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/ghpages-holosecio/">Home</a></li>
         
        <li><a href="/ghpages-holosecio/posts">Writings</a></li>
         
        <li><a href="/ghpages-holosecio/tags">Tags</a></li>
         
        <li><a href="/ghpages-holosecio/about">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/ghpages-holosecio/lib/font-awesome/css/all.min.css>
<script src=/ghpages-holosecio/lib/jquery/jquery.min.js></script>
<script src=/ghpages-holosecio/js/main.js></script>
</html>
